{% extends "restaurant_base.html" %}

{% block bodyclass %}photos_nav{% endblock %}

{% load global_tags %}

{% block content %}
<div class="restaurant_photos">
    
    <div class="header cf">
        
        <h2 class="fleft">Best Photos</h2>
        
    </div>
	
	<div class="best_photos">
		<ul class="cf">
		   {% for photo in request.content_object.best_photos.all %}
		   {% include "inc_photo_item.html" %}
		   {% endfor %}
		</ul>
	</div>
	<div class="sp_hr_line"></div>
	<div class="photos_list">
		<h2>Photos</h2>
		<ul class="cf">
		{% for photo in photos %}
			{% if not photo.best_photo_restaurant.all %}
			    {% include "inc_photo_item.html" %}
			{% endif %}
		{% endfor %}
		</ul>
	</div>

</div>
{% endblock %}


{% block bottom_script %}
<script>
// show photo control panel for restaurant manager
$(document).ready(function(){
	if(true {# is_manager #}) // if manager
	{
		$('.photo_frame').live('mouseenter',function(){
			var pp = $(this).parent().parent();
            var classname = pp.attr('className');
            var class_pre = classname.substr(classname.indexOf('photos_frame')+13,1);
            $(this).parent().parent().find('.operation').css('display','block');
            //$(this).css('background','url({{ MEDIA_URL }}images/bg_photos_'+class_pre+'_grey.png) no-repeat');
        }).live('mouseleave',function(){
        	var pp = $(this).parent().parent();
            var classname = pp.attr('className');
            var class_pre = classname.substr(classname.indexOf('photos_frame')+13,1);
            $(this).parent().parent().find('.operation').css('display','none');
            $(this).css('background','url({{ MEDIA_URL }}images/bg_photos_'+class_pre+'.png) no-repeat');
        });
		
		$('.photo_item .operation').live('mouseenter', function(){
			var pp = $(this).parent();
            var classname = pp.attr('className');
            var class_pre = classname.substr(classname.indexOf('photos_frame')+13,1);
            $(this).css('display','block');
            //$(this).parent().find('.photo_frame').css('background','url({{ MEDIA_URL }}images/bg_photos_'+class_pre+'_grey.png) no-repeat');
		}).live('mouseleave', function(){
			var pp = $(this).parent();
            var classname = pp.attr('className');
            var class_pre = classname.substr(classname.indexOf('photos_frame')+13,1);
            $(this).css('display','none');
            $(this).parent().find('.photo_frame').css('background','url({{ MEDIA_URL }}images/bg_photos_'+class_pre+'.png) no-repeat');
		});
		
		
		$('.photo_item .operation .unbest').live('click',function(){
			var tmp = $(this).parent().parent().find('a').attr('href');
            var photo_id = tmp.substring(tmp.indexOf('photos/')+7,tmp.length-1);
            var remove_target = $(this).parent().parent();
            $.ajax({
               type: "GET",
               dataType: "html",
               url: '/photos/ajax/update-best-photos/add/{{ request.content_object.id }}/'+photo_id,
               success: function(data) {
                   if(data=='full'){
                       alert('The best photo pool is full!');
                   }else{
                       $('.best_photos ul').append(data);
                       remove_target.remove();
                   }
               }
            });
		});
		
		$('.photo_item .operation .best').live('click',function(){
            var tmp = $(this).parent().parent().find('a').attr('href');
            var photo_id = tmp.substring(tmp.indexOf('photos/')+7,tmp.length-1);
            var remove_target = $(this).parent().parent();
            $.ajax({
               type: "GET",
               dataType: "html",
               url: '/photos/ajax/update-best-photos/remove/{{ request.content_object.id }}/'+photo_id,
               success: function(data) {
                   if(data=='full'){
                       alert('The best photo pool is full!');
                   }else{
                       $('.photos_list ul').append(data);
                       remove_target.remove();
                   }
               }
            });
        });
	}
});
</script>
{% endblock %}

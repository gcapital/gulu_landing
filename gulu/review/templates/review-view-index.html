{% extends "review-base.html" %}
{% block extrahead %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/dish.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/review.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/lib/fileuploader.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/photos.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/lib/jquery.autogrow-textarea.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/gulu.js"></script>
{% endblock %}
{% block right %}

{% block title %}{% endblock %}
{% load gcomments_tags global_tags like_tags %}

<div class="review_index">
	<div class="cf best_review review_container row">
	    <h2 class="title">Best Review</h2>
        <div class="fleft photo_bg_69x65"><img src="{{ best_review.user.main_profile_pic.image40x40.url }}" /></div>
        <div class="content">
            <h4 class="name"><strong>{{best_review.user.get_full_name}}</strong></h4>
            <h6 class="time">{{best_review.created}}</h6>
            <p>
                {{best_review.content|truncatewords:"100"}}...
                <span class="read_more"><a href="{% slugurl restaurant restaurant-view-review restaurant.id best_review.id%}"><strong>more</strong></a></span>
            </p>
            <div class="share_buttons">{% like best_review %}</div>
        </div>
    </div>
    
	<div class="sp_hr_line"></div>
	
	<div class="cf helpful_review 2col_row">
		<div class="fleft col_left review_container">
			<h2 class="title">
			    <span>Most Helpful</span>
			    Favorite Reviews
			</h2>
			<div class="fleft photo_bg_69x65"><img src="{{ most_helpful_favorite_review.user.main_profile_pic.image40x40.url }}" /></div>
	        <div class="fleft content">
	            <h4 class="name"><strong>{{most_helpful_favorite_review.user.get_full_name}}</strong></h4>
	            <h6 class="time">{{most_helpful_favorite_review.created}}</h6>
	            <p>
	                {{most_helpful_favorite_review.content|truncatewords:"100"}}...
	                <span class="read_more"><a href="{% slugurl restaurant restaurant-view-review restaurant.id most_helpful_favorite_review.id%}"><strong>more</strong></a></span>
	            </p>
	            <div class="share_buttons">{% like most_helpful_favorite_review %}</div>
	        </div>
		</div>

		<div class="fleft col_right review_container">
		    <h2 class="title">
                <span>Most Helpful</span>
                Critical Reviews
            </h2>
            <div class="fleft photo_bg_69x65"><img src="{{ most_helpful_critical_review.user.main_profile_pic.image40x40.url }}" /></div>
            <div class="fleft content">
                <h4 class="name"><strong>{{most_helpful_critical_review.user.get_full_name}}</strong></h4>
                <h6 class="time">{{most_helpful_critical_review.created}}</h6>
                <p>
                    {{most_helpful_critical_review.content|truncatewords:"100"}}...
                    <span class="read_more"><a href="{% slugurl restaurant restaurant-view-review restaurant.id most_helpful_critical_review.id%}"><strong>more</strong></a></span>
                </p>
                <div class="share_buttons">{% like most_helpful_critical_review %}</div>
            </div>
		</div>
	</div>
	<!-- <div class="sp_hr_line"></div>
	<div class="cf best_photo_video_container 2col_row">
		<div class="best_photo_half fleft col_left">
			<h2 class="title">Best Photos</h2>
			<ul class="cf">
				{% for photo in restaurant.best_photos.all %}
					<li class="fleft">
						<a href="{{ photo.best_photo.get_absolute_url }}"><img src="{{ photo.best_photo.image84x56.url }}" /></a>
					</li>
				{% endfor %}
			</ul>
		</div>
		<div class="best_video fleft col_right">
			<h2 class="title">Best Videos</h2><br />
			
		</div>
	</div> -->
	
	<div class="sp_hr_line"></div>
	
	<div class="review_writer_box">
	    <div class="tabs">
	        <div id="restaurant_tab" class="restaurant tab">Restaurant</div>
	        <div id="dish_tab" class="dish tab back">Dish</div>
	        <div class="bd_top big"></div>
	    </div>
	    <div class="bd big cf">
	       <div id="dish_picker" style="margin: 10px 0 10px 10px; padding: 20px; border: 1px solid black; display:none">
            
              <div id="dish_details"></div>
              <div id="dish_reset"><a>Reset</a></div>
              <input type="text" name="dish_query" id="id_dish_query" />
  
          </div>
	        <div class="give_badge">
	            <h3>Give a Badge</h3>
	            <ul class="fleft cf">
	                <li><div class="delicious"></div><h6>美味</h6></li>
	                <li><div class="service"></div><h6>服務</h6></li>
	                <li><div class="price"></div><h6>價格</h6></li>
	                <li><div class="atmosphere"></div><h6>環境</h6></li>
	            </ul>
	            <span></span>
	            <ul class="fleft cf">
	                <li><div class="worthy"></div><h6>Worthy</h6></li>
	                <li><div class="favorite"></div><h6>Favorite</h6></li>
	                <li><div class="ever_favorite"></div><h6>Favorite</h6></li>
	            </ul>
	        </div>
	        <div class="dish review_form">
	            <form method="post" id="review_form">
	                <h3>Write Review</h3>
	                	                	                
	                <input type="text" value="請輸入您的消費金額">
	                {% csrf_token %}
	                {{ form.restaurant }}
	                {{ form.user }}
	                {{ form.dish }}
	                <div class="common_text_input">
	                    <div id="form_error_msg"></div>
					    {{ form.content }}
					    <div class="tool_box">
					        <div class="tools cf">
						        <div id="btn_upload" class="upload_photo fleft"></div>
						        <div class="buttons fright cf">
		                            <input type="button" class="btn_post" id="review_submit">
		                        </div>
	                        </div>
					        <div class="show_result">
					            <div id="error_msg"></div>
					            <div id="img_placeholder" class="photo"></div>
					        </div>
					    </div>
					    {{ form.photo_id }}
					    {{ form.photo_url }}
					</div>
                    <div class="post_options cf">
                        <div class="cf">
                            <span>同步分享到</span>
                            <input type="checkbox" value="" />
                            <img src="{{ MEDIA_URL }}images/icon_facebook_s.png" alt="share to facebook" />
                            <input type="checkbox" value="" />
                            <img src="{{ MEDIA_URL }}images/icon_twitter_s.png" alt="share to twitter" />
                            <input type="checkbox" value="" />
                            <img src="{{ MEDIA_URL }}images/icon_plurk_s.png" alt="share to plurk" />
                            <div class="more_setting fleft">add more to the <a href="#">setting</a></div>
                        </div>
                    </div>
	            </form>
	        </div>
	    </div>
	    <div class="bd_bottom big"></div>
	</div>
	
	
	<div class="all_review_container row">
		<div id="all_reviews_container">
		{% for review in all_reviews %}
	        {% include 'inc_review_single.html'  %}
		{% endfor %}
		{% if more_review_button %}
		<button class="more_btn" value="" type="button" id="more_review_btn" _owner="{{restaurant.pk}}" _sid="{{all_reviews.count}}"></button>
		{% endif %}
		</div>
	</div>
</div>

{% endblock %}
{% block bottom_script %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/gcomments.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/review.js"></script>
<script>
$(document).ready(function(){
	$('.review_comments').each(function(){
		var comment = new GComments.Commenter({
			container : $(this),
	    });
	});
	
	var ajax_uploader = new Photos.AjaxUploader({
        button: $("#btn_upload"),
        imagespec: 'image186x119',
        errors: $("#error_msg"),
        preview: $("#img_placeholder"),
        input: $("#id_photo_id"),
        url_input: $("#id_photo_url"),
    });
	
	// Initialize the review updater
    var review_post_config = {
        'all_reviews_container': $('#all_reviews_container'),
        'review_submit': $('#review_submit'),
        'review_form': $('#review_form'),
    };  
    var review_post = new Review.Post(review_post_config);
    Review.more.init('#more_review_btn');
    
    $('#dish_tab').click(function(){
    	$(this).removeClass('back');
    	$('#restaurant_tab').addClass('back');
    	$('#dish_picker').show();
    });
    $('#restaurant_tab').click(function(){
        $(this).removeClass('back');
        $('#dish_tab').addClass('back');
        $('#dish_picker').hide();
    });
});
</script>
{% endblock %}